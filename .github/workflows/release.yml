name: Build and Release Process

# Defines environmental variables
env:
  GO_VERSION: '1.22.2'

on:
  release:
    types: [published]
  

jobs:
  build_and_upload_ubuntu:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@0ad4b8fadaa221de15dcec353f45205ec38ea70b # v4.1.4
    
    # Setup Go
    - name: Setup Go
      uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1
      with:
        go-version: "${{ env.GO_VERSION }}" 
    
    - name: Build and Run
      run: |
        go build -o festerize main.go

    # Zip binary for Ubuntu
    - name: Zip binary
      run: zip festerize_ubuntu.zip festerize

    - name: Upload Ubunutu Release Assets
      uses: softprops/action-gh-release@9d7c94cfd0a1f3ed45544c887983e9fa900f0564 # v2.0.4
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        files: festerize_ubuntu.zip

  build_and_upload_mac:
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@0ad4b8fadaa221de15dcec353f45205ec38ea70b # v4.1.4
    
    # Setup Go
    - name: Setup Go
      uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1
      with:
        go-version: "${{ env.GO_VERSION }}" 
    
    - name: Build and Run
      run: |
        go build -o festerize main.go
    # Zip binary for Mac
    - name: Zip binary
      run: zip festerize_mac.zip festerize 
    - name: Upload Mac Release Assets
      uses: softprops/action-gh-release@9d7c94cfd0a1f3ed45544c887983e9fa900f0564 # v2.0.4
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        files: festerize_mac.zip

  build_and_upload_windows:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@0ad4b8fadaa221de15dcec353f45205ec38ea70b # v4.1.4
    
    # Setup Go
    - name: Setup Go
      uses: actions/setup-go@cdcb36043654635271a94b9a6d1392de5bb323a7 # v5.0.1
      with:
        go-version: "${{ env.GO_VERSION }}"
    
    - name: Build and Run
      run: |
        go build -o festerize main.go
      # Zip binary for Windoes
    - name: Zip binary
      run: Compress-Archive -Path festerize -DestinationPath festerize_windows.zip
    - name: Upload Window Release Assets
      uses: softprops/action-gh-release@9d7c94cfd0a1f3ed45544c887983e9fa900f0564 # v2.0.4
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        files: festerize_windows.zip
